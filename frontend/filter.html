<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="./filter.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css?family=Coiny"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link href="https://fonts.cdnfonts.com/css/ponytail" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="icon" type="image/x-icon" href="img.png" />

    <title>Lost/Found pets</title>
  </head>

  <body>
    <header>
      <nav id="navigation">
        <ul class="sidebar">
          <li onclick="hideSidebar()">
            <a href="#"
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                height="26"
                viewBox="0 96 960 960"
                width="26"
              >
                <path
                  d="m249 849-42-42 231-231-231-231 42-42 231 231 231-231 42 42-231 231 231 231-42 42-231-231-231 231Z"
                /></svg
            ></a>
          </li>
          <li><a href="index.html">Home</a></li>
          <li><a href="filter.html">Lost/Found Pets</a></li>
          <li><a href="statistics.html">Statistics</a></li>
          <li><a href="about.html">About us</a></li>
          <li><a href="help.html">Help</a></li>
        </ul>

        <div class="menu-button" onclick="showSidebar()">
          <a href="#"
            ><svg
              xmlns="http://www.w3.org/2000/svg"
              height="26"
              viewBox="0 96 960 960"
              width="26"
            >
              <path
                d="M120 816v-60h720v60H120Zm0-210v-60h720v60H120Zm0-210v-60h720v60H120Z"
              /></svg
          ></a>
        </div>
        <div class="nav-logo">
          <a href="index.html"><img alt="logo_img" src="./img/logo.png" /></a>
        </div>
        <div class="nav-menu">
          <ul>
            <li><a href="index.html" class="link">Home</a></li>
            <li>
              <a href="filter.html" class="link active">Lost/Found Pets</a>
            </li>
            <li><a href="statistics.html" class="link">Statistics</a></li>
            <li><a href="about.html" class="link">About us</a></li>
            <li><a href="help.html" class="link">Help</a></li>
          </ul>
        </div>
        <div class="nav-button">
          <i class="fa-solid fa-rss" id="RSS"></i>
          <a href="login.html" class="btn" id="loginBtn">Sign In</a>
          <div class="dropdown">
            <button class="dropbtn" id="username">Loading...</button>
            <div class="dropdown-content" id="dropdownContent"></div>
          </div>
        </div>
      </nav>
    </header>
    <div class="main--section">
      <div class="section1" id="filterSection">
        <div class="filter--form">
          <p>Filter lost and found pets</p>
          <form id="filterForm" action="#">
            <div class="status-details">
              <span class="status-title">Pet status:</span>
              <div class="types">
                <div class="type">
                  <input type="radio" name="status" id="dot-1" value="lost" />
                  <label for="dot-1">
                    <span class="status">Lost</span>
                  </label>
                </div>
                <div class="type">
                  <input type="radio" name="status" id="dot-2" value="found" />
                  <label for="dot-2">
                    <span class="status">Found/Stray</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="input-box1">
              <span class="input-title">Pet name:</span>
              <input
                class="form-field"
                type="text"
                placeholder="Enter pet name"
                name="petName"
                required
              />
            </div>
            <div class="input-box2">
              <label class="input-title" for="cities">Location:</label>

              <input
                class="form-field"
                type="text"
                placeholder="Enter city, town or area"
                name="city"
                required
              />
            </div>
            <div class="input-box3">
              <span class="input-title">Species:</span>
              <div class="input-box3 types">
                <div class="type">
                  <input type="radio" name="petType" id="type2" value="dog" />
                  <label for="type2">
                    <span class="status">Dog</span>
                  </label>
                </div>
                <div class="type">
                  <input type="radio" name="petType" id="type3" value="cat" />
                  <label for="type3">
                    <span class="status">Cat</span>
                  </label>
                </div>
                <div class="type">
                  <input type="radio" name="petType" id="type4" value="bird" />
                  <label for="type4">
                    <span class="status">Bird</span>
                  </label>
                </div>
                <div class="type">
                  <input
                    type="radio"
                    name="petType"
                    id="type5"
                    value="reptile"
                  />
                  <label for="type5">
                    <span class="status">Reptile</span>
                  </label>
                </div>
                <div class="type">
                  <input type="radio" name="petType" id="type6" value="horse" />
                  <label for="type6">
                    <span class="status">Horse</span>
                  </label>
                </div>
                <div class="type">
                  <input
                    type="radio"
                    name="petType"
                    id="type7"
                    value="ferret"
                  />
                  <label for="type7">
                    <span class="status">Ferret</span>
                  </label>
                </div>
                <div class="type">
                  <input
                    type="radio"
                    name="petType"
                    id="type8"
                    value="rabbit"
                  />
                  <label for="type8">
                    <span class="status">Rabbit</span>
                  </label>
                </div>
                <div class="type">
                  <input type="radio" name="petType" id="type9" value="fox" />
                  <label for="type9">
                    <span class="status">Fox</span>
                  </label>
                </div>
                <div class="type">
                  <input
                    type="radio"
                    name="petType"
                    id="type10"
                    value="other"
                  />
                  <label for="type10">
                    <span class="status">Other</span>
                  </label>
                </div>
              </div>
            </div>
            <div class="input-box4">
              <span class="input-title">Gender:</span>
              <div class="types">
                <div class="type">
                  <input
                    type="radio"
                    name="gender"
                    id="gender2"
                    value="female"
                  />
                  <label for="gender2">
                    <span class="status">Female</span>
                  </label>
                </div>

                <div class="type">
                  <input type="radio" name="gender" id="gender3" value="male" />
                  <label for="gender3">
                    <span class="status">Male</span>
                  </label>
                </div>
                <div class="type">
                  <input
                    type="radio"
                    name="gender"
                    id="gender4"
                    value="unknown"
                  />
                  <label for="gender4">
                    <span class="status">Unknown</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="input-box4">
              <span class="input-title">Within Past:</span>
              <div class="types">
                <div class="type">
                  <input type="radio" name="time" id="time1" value="1 Month" />
                  <label for="time1">
                    <span class="status">1 Month</span>
                  </label>
                </div>
                <div class="type">
                  <input type="radio" name="time" id="time2" value="3 Months" />
                  <label for="time2">
                    <span class="status">3 Months</span>
                  </label>
                </div>

                <div class="type">
                  <input type="radio" name="time" id="time3" value="6 Months" />
                  <label for="time3">
                    <span class="status">6 Months</span>
                  </label>
                </div>
                <div class="type">
                  <input type="radio" name="time" id="time4" value="1 Year" />
                  <label for="time4">
                    <span class="status">1 Year</span>
                  </label>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="button--container">
          <button type="button" class="filter-btn" onclick="filterPets()">
            Find
          </button>
        </div>
      </div>
      <!--section1 end-->
      <div class="section2" id="card--section">
        <div class="section2--title">
          <h2>Lost & Found Pets Database</h2>
          <h4>Find Lost & Found Dogs, Cats & Other Pets in your area.</h4>
        </div>
      </div>
    </div>
    <!--Main section end-->
    <div class="search-menu-bar">
      <ul>
        <li id="filterLink">
          <a href="">
            <img src="./img/filter.png" alt="filter icon" />Filter
          </a>
        </li>
        <li id="listLink">
          <a href="">
            <img src="./img/menu.png" alt="filter icon" />Pet list
          </a>
        </li>
      </ul>
    </div>
    <script src="script.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const radios = document.querySelectorAll('input[type="radio"]');
        radios.forEach((radio) => {
          radio.addEventListener("click", (event) => {
            if (radio.checked) {
              if (radio.previousChecked) {
                radio.checked = false;
                radio.previousChecked = false;
              } else {
                radios.forEach((r) => (r.previousChecked = false));
                radio.previousChecked = true;
              }
            }
          });
        });
      });

      async function filterPets() {
        const form = document.getElementById("filterForm");
        const formData = new FormData(form);

        try {
          const response = await fetch("/filter", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          const reports = await response.json();
          displayReports(reports);
        } catch (error) {
          console.error("There was a problem with the fetch operation:", error);
        }
      }

      function displayReports(reports) {
        const cardSection = document.getElementById("card--section");
        cardSection.innerHTML = "";

        if (reports.length === 0) {
          const noReportsMessage = document.createElement("div");
          noReportsMessage.className = "no-reports";
          noReportsMessage.textContent = "No reports found";
          cardSection.appendChild(noReportsMessage);
          return;
        }

        reports.forEach((report) => {
          const card = document.createElement("div");
          card.className = "card";

          const div = document.createElement("div");
          div.className = "card--image";
          const img = document.createElement("img");
          div.appendChild(img);
          img.alt = "pet-img";
          img.src = `./backend/controllers/uploads/${report.image}`;

          const cardBody = document.createElement("div");
          cardBody.className = "card--body";

          const generalInfo = document.createElement("div");
          generalInfo.className = "general-info";

          const left = document.createElement("div");
          left.className = "left";

          const name = document.createElement("h3");
          name.className = "name";
          name.textContent = report.name;

          const status = document.createElement("h3");
          status.className = "status";
          status.textContent = report.status;

          left.appendChild(name);
          left.appendChild(status);

          const right = document.createElement("div");
          right.className = "right";

          const id = document.createElement("p");
          id.textContent = `ID: ${report.id}`;

          right.appendChild(id);

          generalInfo.appendChild(left);
          generalInfo.appendChild(right);

          const cardDetails = document.createElement("div");
          cardDetails.className = "card--details";

          const details = document.createElement("div");
          const created_at = formatDate(report.created_at);

          details.innerHTML = `<strong>Reported on ${created_at}</strong>`;

          const address = document.createElement("span");
          address.textContent = report.addressLastSeen;

          cardDetails.appendChild(details);
          cardDetails.appendChild(address);

          const viewDetailsLink = document.createElement("a");
          viewDetailsLink.href = `/animal-details.html?id=${report.id}`;
          viewDetailsLink.textContent = "View Details";

          cardBody.appendChild(generalInfo);
          cardBody.appendChild(cardDetails);
          cardBody.appendChild(viewDetailsLink);
          card.appendChild(div);
          card.appendChild(cardBody);

          cardSection.appendChild(card);
        });
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        const day = String(date.getDate()).padStart(2, "0");
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const year = date.getFullYear();
        return `${day}-${month}-${year}`;
      }
    </script>
    <script src="../backend/user/validare_form/validare_user_button.js"></script>
  </body>
</html>
